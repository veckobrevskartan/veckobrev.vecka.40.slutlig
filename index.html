<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Händelseöversikt - Hybrid & Säkerhet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; padding: 20px; color: #333; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 30px;}

        /* Filter */
        .filters { 
            margin-bottom: 20px; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 8px; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            justify-content: center;
            border: 1px solid #e9ecef;
        }
        .filters label { 
            cursor: pointer; 
            font-size: 0.9rem; 
            background: #fff; 
            padding: 5px 10px; 
            border-radius: 20px; 
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }
        .filters label:hover { background: #eee; }
        .filters input { margin-right: 8px; }
        
        /* Tidslinje */
        #visualization { margin-bottom: 40px; border: 1px solid #ddd; border-radius: 4px; background: white;}

        /* Lista (Feed) */
        .feed-container { max-width: 900px; margin: 0 auto; }
        
        .feed-item { 
            margin-bottom: 15px; 
            background: #fff;
            border: 1px solid #e1e4e8; 
            border-radius: 6px; 
            overflow: hidden; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        summary {
            padding: 15px;
            background: #fff;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            list-style: none;
            transition: background 0.2s;
        }
        summary::-webkit-details-marker { display: none; }
        summary:hover { background: #f8f9fa; }
        
        /* Indikator för öppen/stängd */
        summary::after { content: '+'; font-size: 1.5em; color: #aaa; font-weight: 300; }
        details[open] summary::after { content: '-'; }

        .summary-content { display: flex; align-items: baseline; gap: 10px; flex-wrap: wrap; width: 100%;}
        
        .date-badge { 
            font-family: monospace; 
            color: #666; 
            font-size: 0.9em; 
            background: #eee; 
            padding: 2px 6px; 
            border-radius: 4px; 
        }

        .title-text { font-weight: 600; font-size: 1.05em; color: #2c3e50; }

        .cat-badge {
            font-size: 0.75em;
            padding: 3px 8px;
            border-radius: 12px;
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: auto; /* Putta till höger */
            margin-right: 10px;
        }
        
        .content { 
            padding: 20px; 
            border-top: 1px solid #eee; 
            background: #fafbfc; 
            line-height: 1.6; 
            color: #444;
        }
        .source-link { display: block; margin-top: 10px; font-size: 0.85em; color: #007bff; text-decoration: none;}
        .source-link:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <h2>Omvärldsbevakning: Händelser & Tidslinje</h2>

    <div class="filters" id="filter-container"></div>

    <div id="visualization"></div>

    <div class="feed-container" id="feed-container"></div>
</div>

<script>
    // ==========================================================
    //  1. DIN DATA (Rättad syntax och struktur)
    // ==========================================================
    
    const myEvents = [
      {country:'SE',cat:'HYBRID',title:'Misstänkta konton söker drönarpiloter i forum',place:'Sverige (online)',date:'2025-10-05',lat:59.334,lng:18.067,summary:'Nya, misstänkta Facebook-konton erbjuder betalning för flygningar nära skyddsobjekt, och de verkar veta vilka de ska rikta in sig på.',url:'https://www.sverigesradio.se',source:'Sveriges Radio'},
      {country:'SE',cat:'NUCLEAR',title:'Ryskt uranfartyg med motorhaveri utanför Blekinge',place:'31 km SO om Hasslö',date:'2025-09-29',lat:56.118,lng:15.585,summary:'Panamaflaggade Mikhail Dudin ligger för ankar efter motorhaveri; tidigare urantransporter till Seversk.',url:'',source:'Sydöstran'},
      {country:'SE',cat:'DRONE',title:'Drönarlarm vid Ronneby flygplats',place:'Ronneby Airport',date:'2025-09-29',lat:56.266,lng:15.265,summary:'Misstänkt drönare. Plan vände mot Kalmar innan landning i Ronneby.',url:'',source:'Expressen'},
      {country:'SE',cat:'INFRA',title:'Södertälje – försök till stöld vid laddstationer',place:'Järna',date:'2025-10-01',lat:59.092,lng:17.569,summary:'Misstänkt kopparstöld vid laddstationer. Anmälan upprättad.',url:'',source:'Polisen'},
      {country:'SE',cat:'TERROR',title:'Sex skadade i skjutning i Gävle',place:'Gävle',date:'2025-10-04',lat:60.673,lng:17.141,summary:'Sex skadade; misstänkt under 15 år. Polisen utreder försök till mord.',url:'',source:'Aftonbladet'},
      {country:'NO',cat:'INFRA',title:'Totalt stopp i tågtrafiken efter tekniskt fel',place:'Norge',date:'2025-10-04',lat:59.913,lng:10.752,summary:'Kommunikationsfel hos Bane NOR; åtgärdat inom ~30 min men stora följdeffekter.',url:'',source:'Omni'},
      {country:'DK',cat:'MAR',title:'Fartyg misstänks ligga bakom drönarattacker',place:'Öresund',date:'2025-09-26',lat:55.749,lng:12.632,summary:'Astrol-1 m.fl. utreds som plattformar för operationer.',url:'',source:'France24'},
      {country:'DE',cat:'DRONE',title:'München: flyg stoppad två kvällar i rad',place:'Munich Airport',date:'2025-10-02',lat:48.353,lng:11.786,summary:'Rapporterade drönarsiktningar 2–3 okt; tusentals resenärer drabbade.',url:'',source:'The Guardian'},
      {country:'UK',cat:'INTEL',title:'Gripande efter cyberattack mot Heathrow',place:'London',date:'2025-10-02',lat:51.47,lng:-0.454,summary:'Man i 40-årsåldern gripen i West Sussex efter attack mot MUSE; stora störningar.',url:'',source:'AP'},
      {country:'SE',cat:'INTEL',title:'Foxtrot-infiltratör avslöjad hos Securitas',place:'Uppsala',date:'2025-09-10',lat:59.858,lng:17.638,summary:'UG avslöjar att en väktare parallellt arbetat för Foxtrot med transporter/rekrytering.',url:'',source:'SVT/UG'},
      {country:'PL',cat:'MIL',title:'Polen skjuter ner ryska drönare',place:'Polen',date:'2025-09-10',lat:52.237,lng:21.018,summary:'Intrång över flera regioner ledde till luftförsvarsinsats.',url:'',source:'Reuters'},
      {country:'SE',cat:'DRONE',title:'Drönare nära marinbasen i Karlskrona',place:'Karlskrona',date:'2025-09-25',lat:56.115,lng:15.690,summary:'Drönare nära Marinbasen; polis bekräftar egen iakttagelse.',url:'',source:'Aftonbladet'},
      {country:'DK',cat:'DRONE',title:'Kastrup stoppar all trafik efter drönarlarm',place:'Köpenhamn',date:'2025-09-22',lat:55.618,lng:12.651,summary:'Större drönare observerade – trafik stoppas temporärt.',url:'',source:'TV4'},
      {country:'NO',cat:'GPS',title:'GPS-störning tvingade plan avbryta landning',place:'Finnmark',date:'2025-09-18',lat:70.07,lng:29.75,summary:'Widerøe omdirigerades till Båtsfjord; misstänkt jamming från Kolahalvön.',url:'',source:'Eye on the Arctic'},
      {country:'SE',cat:'HYBRID',title:'Bilbrand på Pollettgatan i Helsingborg',place:'Helsingborg',date:'2025-10-11',lat:56.035,lng:12.732,summary:'Anmälan om skadegörelse genom brand upprättad.',url:'',source:'Polisen'},
      {country:'SE',cat:'INTEL',title:'Moderat politiker lämnar efter gängkopplingar',place:'Helsingborg',date:'2025-10-11',lat:56.049,lng:12.704,summary:'Lokalpolitiker lämnar uppdrag efter avslöjanden om kopplingar till kriminellt nätverk.',url:'',source:'HD'},
      {country:'SE',cat:'TERROR',title:'Två skarpa termosbomber på golfbana',place:'Kävlinge',date:'2025-10-09',lat:55.789,lng:13.112,summary:'Nationella bombskyddet oskadliggjorde föremålen.',url:'',source:'Polisen'},
      {country:'SE',cat:'TERROR',title:'Rekordstort beslag av 50 handgranater',place:'Malmö/Arlöv',date:'2025-10-02',lat:55.63,lng:13.05,summary:'Polisen beslagtog 50 handgranater i två bilar.',url:'',source:'Polisen'},
      {country:'SE',cat:'INFRA',title:'Farligt gods läcker från godståg',place:'Norrköping',date:'2025-09-19',lat:58.595,lng:16.188,summary:'Läckage på bangården, en person till sjukhus.',url:'',source:'Corren'},
      
      // ... DU KAN KLISTRA IN RESTEN AV DIN LÅNGA LISTA HÄR (Se till att kommatecken och klamrar stämmer) ...
      
    ];

    // ==========================================================
    //  2. LOGIK (Uppdaterad för att läsa dina engelska fält)
    // ==========================================================

    function stringToColor(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
        return '#' + '00000'.substring(0, 6 - c.length) + c;
    }

    // Mappning till dina fältnamn: "cat" istället för "kategori"
    const uniqueCategories = [...new Set(myEvents.map(e => e.cat))];
    let activeCategories = new Set(uniqueCategories);

    const categoryColors = {};
    uniqueCategories.forEach(cat => {
        categoryColors[cat] = stringToColor(cat + "seed");
    });

    const feedContainer = document.getElementById('feed-container');
    const filterContainer = document.getElementById('filter-container');
    const timelineContainer = document.getElementById('visualization');

    // -- SKAPA FILTER --
    uniqueCategories.forEach(cat => {
        const label = document.createElement('label');
        label.style.borderColor = categoryColors[cat]; // Kantfärg
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = true;
        checkbox.value = cat;
        
        checkbox.addEventListener('change', (e) => {
            if (e.target.checked) activeCategories.add(cat);
            else activeCategories.delete(cat);
            renderAll();
        });

        label.appendChild(checkbox);
        const span = document.createElement('span');
        span.innerText = cat;
        span.style.color = categoryColors[cat]; // Textfärg
        span.style.fontWeight = "bold";
        label.appendChild(span);
        
        filterContainer.appendChild(label);
    });

    // -- INITIERA TIDSLINJE --
    let timeline;
    let timelineData = new vis.DataSet([]);
    let timelineGroups = new vis.DataSet([]);

    function initTimeline() {
        const groups = uniqueCategories.map(cat => ({
            id: cat,
            content: cat,
            style: `border-left: 5px solid ${categoryColors[cat]};`
        }));
        timelineGroups.add(groups);

        const options = {
            height: '400px',
            stack: true,
            zoomMin: 1000 * 60 * 60 * 24 * 1, // 1 dag
            zoomMax: 1000 * 60 * 60 * 24 * 365, // 1 år
            start: '2025-09-01', // Sätter startdatum så det passar din data
            end: '2025-11-01'
        };

        timeline = new vis.Timeline(timelineContainer, timelineData, timelineGroups, options);
        
        // Klick-händelse i tidslinjen (scrolla till element i listan)
        timeline.on('select', function (properties) {
            if(properties.items.length > 0) {
                const itemId = properties.items[0];
                const element = document.getElementById(`item-${itemId}`);
                if(element) {
                    element.open = true;
                    element.scrollIntoView({behavior: "smooth", block: "center"});
                }
            }
        });
    }

    // -- RENDERA ALLT --
    function renderAll() {
        feedContainer.innerHTML = '';
        
        // Mappning: Filtrera på 'cat'
        const filtered = myEvents.filter(item => activeCategories.has(item.cat));

        // Tidslinje data (Mappning: cat, date, title, summary)
        timelineData.clear();
        const timelineItems = filtered.map((item, index) => ({
            id: index,
            group: item.cat, 
            start: item.date,
            content: item.title,
            title: `<div style="max-width:200px;"><b>${item.title}</b><br>${item.summary}</div>`, // Tooltip
            style: `background-color: ${categoryColors[item.cat]}; color: white; border:none; border-radius: 3px;`
        }));
        timelineData.add(timelineItems);

        // Feed data (Sortera på 'date' fallande)
        const sortedList = filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

        sortedList.forEach((item, index) => {
            const details = document.createElement('details');
            details.className = 'feed-item';
            details.id = `item-${index}`; // ID för länkning från tidslinjen
            details.style.borderLeft = `6px solid ${categoryColors[item.cat]}`;

            const summary = document.createElement('summary');
            summary.innerHTML = `
                <div class="summary-content">
                    <span class="date-badge">${item.date}</span>
                    <span class="title-text">${item.title}</span>
                    <span class="cat-badge" style="background-color: ${categoryColors[item.cat]}">${item.cat}</span>
                </div>
            `;

            const content = document.createElement('div');
            content.className = 'content';
            
            // Bygger innehållet
            let htmlContent = `<p><b>Plats:</b> ${item.place} (${item.country})</p>`;
            htmlContent += `<p>${item.summary}</p>`;
            if(item.source) htmlContent += `<p style="font-size:0.9em; color:#666;">Källa: ${item.source}</p>`;
            if(item.url) htmlContent += `<a href="${item.url}" target="_blank" class="source-link">Läs mer &rarr;</a>`;

            content.innerHTML = htmlContent;

            details.appendChild(summary);
            details.appendChild(content);
            feedContainer.appendChild(details);
        });
    }

    initTimeline();
    renderAll();

</script>

</body>
</html>
